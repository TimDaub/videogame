var t=window.location.href+"images/",i={},s=["background.png","walkright.png","walkleft.png","map.png"];function e(){return Object.keys(i).reduce((function(t,s){return t&&i[s].loaded}),!0)}function n(t){return i[t]}function h(){s.forEach((function(t){var s=t.split(".")[0];i[s]={sprite:new Image,loaded:!1,file:t}})),Object.keys(i).forEach((function(s){var e;(e=i[s]).sprite.src=t+e.file,e.sprite.onload=function(){e.loaded=!0}}))}function o(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}}class l{constructor(t,i,s,e,h,o,l,a){this.spawnX=s,this.spawnY=e,this.respawn=l,this.health=100,this.w=t,this.h=i,this.x=s,this.y=e,this.vx=h,this.vy=o,this.weight=.8,this.ticks=0,this.ticksPerFrame=3,this.animation=0,a.forEach(t=>{this[t]=n(t)}),this.walkAsset=this.walkright,this.walkSpeed=5,this.initControls()}initControls(){let t=[],i=[],s=t=>(t.map(clearInterval),[]),e=t=>(this.walk(t),setInterval(()=>this.walk(t),5));document.onkeydown=s=>{32===(s=s||window.event).keyCode&&this.jump(-14),37!==s.keyCode&&65!==s.keyCode||t.push(e(-1*this.walkSpeed)),39!==s.keyCode&&68!==s.keyCode||i.push(e(this.walkSpeed))},document.onkeyup=e=>{37!==(e=e||window.event).keyCode&&65!==e.keyCode||(t=s(t),this.walk(0)),39!==e.keyCode&&68!==e.keyCode||(i=s(i),this.walk(0))}}revive(t){this.x=this.spawnX,this.y=this.spawnY,this.vx=0,this.vy=0,this.health=100}jump(t){0===this.vy&&(this.vy=t)}walk(t){this.vx=t}update(t){this.updateAnimation();let i=window.globals.map.tiles;this.vy+=window.globals.gravity/this.weight*Math.sqrt(t,2);let s=this.x+this.vx,e=this.y+this.vy;i.forEach(t=>{let i=t.collide(s,e,this.w,this.h);if(i){let s=Object.keys(i).sort((t,s)=>Math.abs(i[t])>Math.abs(i[s])?1:-1).shift(),{left:e,right:n,bottom:h,top:o}=i;"bottom"===s&&e>30&&n>30&&(this.y=t.y-this.h,this.vy=0),"left"===s&&(this.x=t.x-this.w,this.vx=0),"right"===s&&(this.vx=0)}}),this.x+=this.vx,this.y+=this.vy,this.health<=0&&this.respawn&&this.revive(100),this.y>=window.globals.world.screen.height&&(this.health=0)}updateAnimation(){this.ticks+=1,this.ticks>this.ticksPerFrame&&(this.ticks=0,this.animation+=1,4===this.animation&&(this.animation=0)),0===this.vx?this.ticksPerFrame=1/0:this.ticksPerFrame=3}render(){e()&&this.health&&(this.vx>0?this.walkAsset=this.walkright:this.vx<0&&(this.walkAsset=this.walkleft),window.globals.ctx.beginPath(),window.globals.ctx.drawImage(this.walkAsset.sprite,this.w*this.animation,0,this.w,this.h,window.globals.canvas.width/2-this.w/2,this.y,this.w,this.h),window.globals.debug.on&&(window.globals.ctx.globalCompositeOperation="source-over",window.globals.ctx.lineWidth=window.globals.debug.lineWidth,window.globals.ctx.strokeStyle="#FF0000",window.globals.ctx.strokeRect(window.globals.canvas.width/2-this.w/2,this.y,this.w,this.h)),window.globals.ctx.closePath())}}class a{constructor(t,i,s,e,n,h,o,l,a,r){this.asset=t,this.sx=i,this.sy=s,this.sw=e,this.sh=n,this.x=h,this.y=o,this.w=l,this.h=a,this.blocking=r}collide(t,i,s,e,n){return(this.blocking||n)&&i+e>=this.y&&this.y+this.h>=i&&t+s>=this.x&&this.x+this.w>=t?{bottom:Math.floor(i+e-this.y),top:this.y+this.h-i,left:t+s-this.x,right:this.x+this.w-t}:null}render(t){t||(t=0),e()&&(window.globals.ctx.beginPath(),window.globals.ctx.drawImage(this.asset.sprite,this.sx,this.sy,this.sw,this.sh,this.x-t,this.y,this.w,this.h),window.globals.debug.on&&(window.globals.ctx.globalCompositeOperation="source-over",window.globals.ctx.lineWidth=window.globals.debug.lineWidth,window.globals.ctx.strokeStyle="#FF0000",window.globals.ctx.strokeRect(this.x-t,this.y,this.w,this.h)),window.globals.ctx.closePath())}}const r={floatBig:{sx:40,sy:27,sw:100,sh:75,blocking:!0},grasLeft:{sx:35,sy:185,sw:90,sh:100,blocking:!0},grasRight:{sx:515,sy:185,sw:40,sh:87,blocking:!0},gras:{sx:190,sy:185,sw:50,sh:40,blocking:!0},tree:{sx:190,sy:47,sw:125,sh:116,blocking:!1}};function d(t,i,s,e,h){var o=r[t],l=n("map");return new a(l,o.sx,o.sy,o.sw,o.sh,i,s,e||o.sw,h||o.sh,o.blocking)}class w{constructor(){this.tiles=[],this.tiles.push(d("floatBig",830,500,100,83)),this.tiles.push(d("floatBig",930,550,100,83)),this.tiles.push(d("floatBig",1050,550,100,83)),this.tiles.push(d("floatBig",750,600,100,83)),this.tiles.push(d("floatBig",550,550,100,83)),this.tiles.push(d("grasLeft",200,600)),this.tiles.push(d("gras",290,600)),this.tiles.push(d("gras",336,600)),this.tiles.push(d("gras",384,600)),this.tiles.push(d("gras",432,600))}addTile(t){t.x+=this.mapOffset(),this.tiles.push(t)}mapOffset(){let t=window.globals.canvas.width/2-window.globals.player.w/2;return window.globals.player.x-t}render(){e()&&this.tiles.forEach(t=>t.render(this.mapOffset()))}}class c{constructor(t,i){this.w=t,this.h=i,this.img=new Image,this.load()}load(){var t=`\n            <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">\n                <defs>\n                    <pattern id="smallGrid" width="${this.w}" height="${this.h}"\n                             patternUnits="userSpaceOnUse">\n                        <path d="M ${this.w} 0 L 0 0 0 ${this.h}" fill="none" stroke="gray"\n                              stroke-width="0.5" />\n                    </pattern>\n                    <pattern id="grid" width="80" height="80"\n                             patternUnits="userSpaceOnUse">\n                        <rect width="80" height="80" fill="url(#smallGrid)" />\n                        <path d="M 80 0 L 0 0 0 80" fill="none" stroke="gray"\n                              stroke-width="1" />\n                    </pattern>\n                </defs>\n                <rect width="100%" height="100%" fill="url(#grid)" />\n            </svg>\n        `,i=window.URL||window.webkitURL||window,s=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),e=i.createObjectURL(s);this.img.onload=function(){i.revokeObjectURL(e)},this.img.src=e}update(){}render(){window.globals.ctx.drawImage(this.img,0,0)}}class g{constructor(t){this.screen=o(),this.asset=n(t)}render(){e()&&(window.globals.ctx.beginPath(),window.globals.ctx.drawImage(this.asset.sprite,0,0,window.globals.canvas.width,window.globals.canvas.height),window.globals.ctx.closePath())}}class p{constructor(t,i,s,e,n,h){this.mt=t,this.mr=i,this.mb=s,this.ml=e,this.x=this.y=this.w=this.h=0,this.map=n,this.visible=h,this.pick=null,this.tiles=null,this.padding={right:35,left:35},this.grid=new c(5,5),this.initControls()}initControls(){document.onmousedown=t=>{t=t||window.event,this.tiles.forEach(i=>{i.collide(t.x,t.y,0,0,!0)&&(this.pick=i)})},document.onmouseup=t=>{this.pick&&(this.map.addTile(this.pick),this.tiles=this.loadTiles(),this.pick=null)},document.onmousemove=t=>{t=t||window.event,this.pick&&(this.pick.x=Math.floor(t.x/this.grid.w)*this.grid.w,this.pick.y=Math.floor(t.y/this.grid.h)*this.grid.h)}}loadTiles(){let t=[],i=Object.keys(r);for(let s=0;s<i.length;s++){let e=t.reduce((t,i)=>t+i.sw,0);e+=this.x+(s+1)*this.padding.right+s*this.padding.left;const n=this.y+(this.h-r[i[s]].sh)/2;t.push(d(i[s],e,n))}return t}update(){this.x=this.ml,this.y=this.mt,this.w=window.globals.canvas.width-this.mr-this.ml,this.h=window.globals.canvas.height-this.mb-this.mt,this.tiles=this.loadTiles(),this.grid.update()}render(){e()&&this.visible&&(window.globals.ctx.beginPath(),window.globals.ctx.globalCompositeOperation="source-over",window.globals.ctx.lineWidth=2,window.globals.ctx.strokeStyle="#000000",window.globals.ctx.strokeRect(this.x,this.y,this.w,this.h),window.globals.ctx.closePath(),this.pick&&this.pick.render(),this.grid.render(),this.tiles.forEach(t=>t.render()))}}!function(t,i){void 0===i&&(i={});var s=i.insertAt;if(t&&"undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===s&&e.firstChild?e.insertBefore(n,e.firstChild):e.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}("html, body, div,\nheader, footer, main, section, nav,\nh1, h2, h3, h4, h5, h6, img, svg,\np, a, hr, span, ol, ul, li,\nform, input, label {\n  margin: 0;\n  padding: 0;\n  border: none;\n  font-size: 100%;\n  font: inherit;\n  vertical-align: baseline; }\n\n*,\n*::before,\n*::after {\n  box-sizing: border-box; }\n\nimg {\n  max-width: 100%; }\n\nsvg:not(:root) {\n  overflow: hidden; }\n\ninput {\n  border-radius: 0; }\n\n::placeholder {\n  opacity: 1; }\n\na {\n  background-color: transparent;\n  text-decoration: none;\n  color: inherit;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n  outline: none; }\n\nhtml {\n  font-size: 10px; }\n\nbody {\n  line-height: 1.3;\n  overflow: hidden; }\n\n.container {\n  width: 85%;\n  max-width: 960px;\n  margin-right: auto;\n  margin-left: auto; }\n");document.addEventListener("DOMContentLoaded",()=>{function t(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}window.globals={canvas:null,ctx:null,ground:550,gravity:6,map:null,world:null,debug:{on:!0,lineWidth:1}};var i,s=t();requestAnimationFrame((function e(){i=t(),function(t){let{width:i,height:s}=o();window.globals.canvas.width=i,window.globals.canvas.height=s,window.globals.player.update(t),window.globals.editorMenu.update()}((i-s)/1e3),window.globals.world.render(),window.globals.editorMenu.render(),window.globals.map.render(),window.globals.player.render(),s=i,requestAnimationFrame(e)})),h(),function(t){window.globals.canvas=document.querySelector("canvas"),window.globals.ctx=window.globals.canvas.getContext("2d"),window.globals.map=new w,window.globals.editorMenu=new p(50,50,window.globals.canvas.height-50,50,window.globals.map,!0),window.globals.world=new g("background"),window.globals.player=new l(67,61,430,520,0,0,!1,["walkright","walkleft"])}()});

var t={background:{path:"images/background.png"},playerRunLeft:{path:"images/run_left.png",numOfFrames:20,sx:0,sWidth:146,sHeight:226,tickSpeed:1,dy:5},playerRunRight:{path:"images/run_right.png",numOfFrames:20,sx:0,sWidth:146,sHeight:226,tickSpeed:1,dy:5},playerIdleRight:{path:"images/idle_right.png",numOfFrames:20,sx:0,sWidth:100,sHeight:227,tickSpeed:1,dy:5},playerIdleLeft:{path:"images/idle_left.png",numOfFrames:20,sx:0,sWidth:100,sHeight:227,tickSpeed:1,dy:5},map:{path:"images/map.png"}};function s(s){return t[s]}function i(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}}const e="playerIdleRight",n=5;let h=1;class o{constructor(t,s,i,n,h,o,l,a){this.spawnX=i,this.spawnY=n,this.respawn=l,this.health=100,this.w=t,this.h=s,this.x=i,this.y=n,this.vx=h,this.vy=o,this.weight=.8,this.assets=a,this.currentAsset=this.assets[e],this.ticksPerFrame=this.currentAsset.tickSpeed,this.currentTick=0,this.ticks=0,this.initControls()}initControls(){let t=[],s=[],i=t=>(t.map(clearInterval),[]),e=t=>(this.walk(t),setInterval(()=>this.walk(t),5));document.onkeydown=i=>{32===(i=i||window.event).keyCode&&this.jump(-14),37!==i.keyCode&&65!==i.keyCode||t.push(e(-1*n)),39!==i.keyCode&&68!==i.keyCode||s.push(e(n))},document.onkeyup=e=>{37!==(e=e||window.event).keyCode&&65!==e.keyCode||(t=i(t),this.walk(0)),39!==e.keyCode&&68!==e.keyCode||(s=i(s),this.walk(0))}}revive(t){this.x=this.spawnX,this.y=this.spawnY,this.vx=0,this.vy=0,this.health=100}jump(t){0===this.vy&&(this.vy=t)}walk(t){this.vx=t}update(t){this.updateAnimation();let s=window.globals.map.tiles;this.vy+=window.globals.gravity/this.weight*Math.sqrt(t,2);let i=this.x+this.vx,e=this.y+this.vy;s.forEach(t=>{let s=t.collide(i,e,this.w,this.h);if(s){let i=Object.keys(s).sort((t,i)=>Math.abs(s[t])>Math.abs(s[i])?1:-1).shift(),{left:e,right:n,bottom:h,top:o}=s;"bottom"===i&&e>30&&n>30&&(this.y=t.y-this.h,this.vy=0),"left"===i&&(this.x=t.x-this.w,this.vx=0),"right"===i&&(this.vx=0)}}),this.x+=this.vx,this.y+=this.vy,this.health<=0&&this.respawn&&this.revive(100),this.y>=window.globals.world.screen.height&&(this.health=0)}updateAnimation(){this.ticks+=1,this.ticks>this.ticksPerFrame&&(this.ticks=0,this.currentTick+=1,this.currentTick===this.currentAsset.numOfFrames&&(this.currentTick=0)),this.ticksPerFrame=this.currentAsset.tickSpeed}render(){this.health&&(this.vx>0?this.currentAsset=this.assets.playerRunRight:this.vx<0?this.currentAsset=this.assets.playerRunLeft:0===this.vx&&h>0?this.currentAsset=this.assets.playerIdleRight:0===this.vx&&h<0?this.currentAsset=this.assets.playerIdleLeft:0===this.vx&&0===h||(this.currentAsset=this.assets[e]),h=this.vx,window.globals.ctx.beginPath(),window.globals.ctx.drawImage(this.currentAsset.sprite,this.currentAsset.sWidth*this.currentTick,0,this.currentAsset.sWidth,this.currentAsset.sHeight,window.globals.canvas.width/2-this.w/2,this.y+this.currentAsset.dy,this.currentAsset.sWidth/2,this.currentAsset.sHeight/2),window.globals.debug.on&&(window.globals.ctx.globalCompositeOperation="source-over",window.globals.ctx.lineWidth=window.globals.debug.lineWidth,window.globals.ctx.strokeStyle="#FF0000",window.globals.ctx.strokeRect(window.globals.canvas.width/2-this.w/2,this.y,this.w,this.h)),window.globals.ctx.closePath())}}class l{constructor(t,s,i,e,n,h,o,l,a,r){this.asset=t,this.sx=s,this.sy=i,this.sw=e,this.sh=n,this.x=h,this.y=o,this.w=l,this.h=a,this.blocking=r}collide(t,s,i,e,n){return(this.blocking||n)&&s+e>=this.y&&this.y+this.h>=s&&t+i>=this.x&&this.x+this.w>=t?{bottom:Math.floor(s+e-this.y),top:this.y+this.h-s,left:t+i-this.x,right:this.x+this.w-t}:null}render(t){t||(t=0),window.globals.ctx.beginPath(),window.globals.ctx.drawImage(this.asset.sprite,this.sx,this.sy,this.sw,this.sh,this.x-t,this.y,this.w,this.h),window.globals.debug.on&&(window.globals.ctx.globalCompositeOperation="source-over",window.globals.ctx.lineWidth=window.globals.debug.lineWidth,window.globals.ctx.strokeStyle="#FF0000",window.globals.ctx.strokeRect(this.x-t,this.y,this.w,this.h),window.globals.ctx.closePath())}}const a={floatBig:{sx:40,sy:27,sw:100,sh:75,blocking:!0},grasLeft:{sx:35,sy:185,sw:90,sh:100,blocking:!0},grasRight:{sx:515,sy:185,sw:40,sh:87,blocking:!0},gras:{sx:190,sy:185,sw:50,sh:40,blocking:!0},tree:{sx:190,sy:47,sw:125,sh:116,blocking:!1}};function r(t,i,e,n,h){var o=a[t],r=s("map");return new l(r,o.sx,o.sy,o.sw,o.sh,i,e,n||o.sw,h||o.sh,o.blocking)}class d{constructor(){this.tiles=[],this.tiles.push(r("floatBig",830,500,100,83)),this.tiles.push(r("floatBig",930,550,100,83)),this.tiles.push(r("floatBig",1050,550,100,83)),this.tiles.push(r("floatBig",750,600,100,83)),this.tiles.push(r("floatBig",550,550,100,83)),this.tiles.push(r("grasLeft",200,600)),this.tiles.push(r("gras",290,600)),this.tiles.push(r("gras",336,600)),this.tiles.push(r("gras",384,600)),this.tiles.push(r("gras",432,600))}addTile(t){t.x+=this.mapOffset(),this.tiles.push(t)}mapOffset(){let t=window.globals.canvas.width/2-window.globals.player.w/2;return window.globals.player.x-t}render(){this.tiles.forEach(t=>t.render(this.mapOffset()))}}class w{constructor(t,s){this.w=t,this.h=s,this.img=new Image,this.load()}load(){var t=`\n            <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">\n                <defs>\n                    <pattern id="smallGrid" width="${this.w}" height="${this.h}"\n                             patternUnits="userSpaceOnUse">\n                        <path d="M ${this.w} 0 L 0 0 0 ${this.h}" fill="none" stroke="gray"\n                              stroke-width="0.5" />\n                    </pattern>\n                    <pattern id="grid" width="80" height="80"\n                             patternUnits="userSpaceOnUse">\n                        <rect width="80" height="80" fill="url(#smallGrid)" />\n                        <path d="M 80 0 L 0 0 0 80" fill="none" stroke="gray"\n                              stroke-width="1" />\n                    </pattern>\n                </defs>\n                <rect width="100%" height="100%" fill="url(#grid)" />\n            </svg>\n        `,s=window.URL||window.webkitURL||window,i=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),e=s.createObjectURL(i);this.img.onload=function(){s.revokeObjectURL(e)},this.img.src=e}update(){}render(){window.globals.ctx.drawImage(this.img,0,0)}}class c{constructor(t){this.screen=i(),this.asset=t}render(){window.globals.ctx.beginPath(),window.globals.ctx.drawImage(this.asset.sprite,0,0,window.globals.canvas.width,window.globals.canvas.height),window.globals.ctx.closePath()}}class g{constructor(t,s,i,e,n,h){this.mt=t,this.mr=s,this.mb=i,this.ml=e,this.x=this.y=this.w=this.h=0,this.map=n,this.visible=h,this.pick=null,this.tiles=null,this.padding={right:35,left:35},this.grid=new w(5,5),this.initControls()}initControls(){document.onmousedown=t=>{t=t||window.event,this.tiles.forEach(s=>{s.collide(t.x,t.y,0,0,!0)&&(this.pick=s)})},document.onmouseup=t=>{this.pick&&(this.map.addTile(this.pick),this.tiles=this.loadTiles(),this.pick=null)},document.onmousemove=t=>{t=t||window.event,this.pick&&(this.pick.x=Math.floor(t.x/this.grid.w)*this.grid.w,this.pick.y=Math.floor(t.y/this.grid.h)*this.grid.h)}}loadTiles(){let t=[],s=Object.keys(a);for(let i=0;i<s.length;i++){let e=t.reduce((t,s)=>t+s.sw,0);e+=this.x+(i+1)*this.padding.right+i*this.padding.left;const n=this.y+(this.h-a[s[i]].sh)/2;t.push(r(s[i],e,n))}return t}update(){this.x=this.ml,this.y=this.mt,this.w=window.globals.canvas.width-this.mr-this.ml,this.h=window.globals.canvas.height-this.mb-this.mt,this.tiles=this.loadTiles(),this.grid.update()}render(){this.visible&&(window.globals.ctx.beginPath(),window.globals.ctx.globalCompositeOperation="source-over",window.globals.ctx.lineWidth=2,window.globals.ctx.strokeStyle="#000000",window.globals.ctx.strokeRect(this.x,this.y,this.w,this.h),window.globals.ctx.closePath(),this.pick&&this.pick.render(),this.grid.render(),this.tiles.forEach(t=>t.render()))}}!function(t,s){void 0===s&&(s={});var i=s.insertAt;if(t&&"undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&e.firstChild?e.insertBefore(n,e.firstChild):e.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}("html, body, div,\nheader, footer, main, section, nav,\nh1, h2, h3, h4, h5, h6, img, svg,\np, a, hr, span, ol, ul, li,\nform, input, label {\n  margin: 0;\n  padding: 0;\n  border: none;\n  font-size: 100%;\n  font: inherit;\n  vertical-align: baseline; }\n\n*,\n*::before,\n*::after {\n  box-sizing: border-box; }\n\nimg {\n  max-width: 100%; }\n\nsvg:not(:root) {\n  overflow: hidden; }\n\ninput {\n  border-radius: 0; }\n\n::placeholder {\n  opacity: 1; }\n\na {\n  background-color: transparent;\n  text-decoration: none;\n  color: inherit;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n  outline: none; }\n\nhtml {\n  font-size: 10px; }\n\nbody {\n  line-height: 1.3;\n  overflow: hidden; }\n\n.container {\n  width: 85%;\n  max-width: 960px;\n  margin-right: auto;\n  margin-left: auto; }\n");document.addEventListener("DOMContentLoaded",async()=>{function e(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}window.globals={canvas:null,ctx:null,ground:550,gravity:6,map:null,world:null,debug:{on:!1,lineWidth:1}};var n,h=e();await async function(i){await async function(){const s=[];Object.keys(t).forEach(i=>{var e=t[i];e.sprite=new Image,e.sprite.src=window.location.href+e.path,s.push(new Promise((t,s)=>e.sprite.onload=t)),t[i]=e}),await Promise.all(s)}(),window.globals.canvas=document.querySelector("canvas"),window.globals.ctx=window.globals.canvas.getContext("2d"),window.globals.map=new d,window.globals.editorMenu=new g(50,50,window.globals.canvas.height-50,50,window.globals.map,!0),window.globals.world=new c(s("background")),window.globals.player=new o(73,113,430,220,0,0,!1,{playerRunLeft:s("playerRunLeft"),playerRunRight:s("playerRunRight"),playerIdleRight:s("playerIdleRight"),playerIdleLeft:s("playerIdleLeft")})}(),requestAnimationFrame((function t(){n=e(),function(t){let{width:s,height:e}=i();window.globals.canvas.width=s,window.globals.canvas.height=e,window.globals.player.update(t),window.globals.editorMenu.update()}((n-h)/1e3),window.globals.world.render(),window.globals.editorMenu.render(),window.globals.map.render(),window.globals.player.render(),h=n,requestAnimationFrame(t)}))});
